<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chord Progression Helper</title>
    <style>
      :root {
        --bg-color: #1a1a1a;
        --card-bg: #2a2a2a;
        --text-color: #ffffff;
        --roman-color: #999999;

        --major-color: #00d4ff;
        --minor-color: #ff6b9d;
        --secondary-color: #00ff88;

        --shadow-color: rgba(0, 0, 0, 0.6);
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family:
          "SF Pro Display",
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          Roboto,
          sans-serif;
        background-color: var(--card-bg);
        color: var(--text-color);
        min-height: 100vh;
        margin: 0;
        padding: 10px;
      }

      .app {
        text-align: center;
        max-width: 1200px;
        margin: 0 auto;
        padding-top: 20px;
      }

      .key-selector {
        font-size: 0.9em;
        font-weight: 600;
        padding: 8px 16px;
        border-radius: 12px;
        border: none;
        background: var(--bg-color);
        color: var(--text-color);
        margin-bottom: 0;
        cursor: pointer;
        outline: none;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        transition: all 0.2s ease;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        background-image: none;
        text-align: center;
        text-align-last: center;
      }

      .toggle-container {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        gap: 20px;
        margin-bottom: 20px;
      }

      .toggle-button {
        font-size: 0.9em;
        font-weight: 600;
        padding: 8px 16px;
        border-radius: 12px;
        border: none;
        background: var(--bg-color);
        color: var(--text-color);
        cursor: pointer;
        outline: none;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        transition: all 0.2s ease;
        position: relative;
        overflow: hidden;
      }

      .toggle-button.active {
        background: #00cc77;
        color: var(--bg-color);
      }

      .chords-display {
        display: flex;
        gap: 20px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .chord-card {
        background: var(--bg-color);
        border-radius: 15px;
        padding: 25px 0px;
        border: 3px solid transparent;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        flex: 1;
        min-width: 140px;
        max-width: 180px;
        cursor: pointer;
      }

      

      .roman-numeral {
        font-size: 1.4em;
        font-weight: 300;
        color: var(--roman-color);
        margin-bottom: 12px;
        letter-spacing: 1px;
      }

      .chord-name {
        font-size: 2.8em;
        font-weight: 900;
        transition: all 0.3s ease;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }

      .chord-notes {
        margin-top: 15px;
        font-size: 1em;
        font-weight: 400;
        color: var(--roman-color);
        letter-spacing: 2px;
        opacity: 0.8;
        transition: all 0.3s ease;
        word-spacing: 10px;
      }

      .note {
        padding: 4px 8px;
        border-radius: 4px;
        transition: all 0.2s ease;
        display: inline-block;
        font-weight: 600;
      }

      .note.highlighted {
        background: var(--secondary-color);
        color: var(--bg-color);
        font-weight: 700;
      }

  

      .chord-card.matching {
        border: 3px solid #00cc77;
        background: #353535;
        box-shadow: 0 12px 30px rgba(0, 204, 119, 0.4);
      }

      .chord-card.non-matching {
        opacity: 0.4;
        border: 3px solid rgba(255, 255, 255, 0.05);
      }

      

      .chord-card.chord-major {
      }
      .chord-card.chord-major .chord-name {
        color: var(--major-color);
        text-transform: uppercase;
        font-weight: 900;
        filter: drop-shadow(0 0 10px rgba(0, 212, 255, 0.3));
      }
      .chord-card.chord-major .roman-numeral {
        text-transform: uppercase;
        font-weight: 700;
        color: #cccccc;
      }

      .chord-card.chord-minor {
      }
      .chord-card.chord-minor .chord-name {
        color: var(--minor-color);
        font-weight: 600;
        font-style: italic;
        filter: drop-shadow(0 0 10px rgba(255, 107, 157, 0.3));
      }
      .chord-card.chord-minor .roman-numeral {
        text-transform: lowercase;
        font-weight: 300;
        font-style: italic;
        color: #aaaaaa;
      }

      .chord-card.chord-secondary {
      }
      .chord-card.chord-secondary .chord-name {
        color: var(--secondary-color);
        font-weight: 800;
        filter: drop-shadow(0 0 10px rgba(0, 255, 136, 0.3));
      }
      .chord-card.chord-secondary .roman-numeral {
        font-size: 1.2em;
        font-weight: 600;
        color: #bbbbbb;
      }

      @media (min-width: 769px) {
        .chords-display {
          flex-wrap: nowrap;
        }
        .chord-card {
          flex: 1;
          min-width: 0;
        }
      }

      @media (max-width: 768px) {
        .container {
          padding: 30px 20px;
        }
        .chords-display {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 15px;
        }
        .chord-card {
          padding: 20px 15px;
          min-width: 0;
          max-width: none;
        }
        .chord-name {
          font-size: 2.2em;
        }
        .chord-notes {
          font-size: 0.9em;
          margin-top: 12px;
        }
      }

      @media (max-width: 480px) {
        .container {
          padding: 25px 15px;
        }
        .chords-display {
          gap: 12px;
        }
        .chord-name {
          font-size: 1.9em;
        }
        .chord-notes {
          font-size: 0.8em;
          letter-spacing: 1px;
        }
        .key-selector {
          font-size: 0.9em;
          padding: 8px 16px;
        }
        .chord-notes {
          word-spacing: 0;
          line-height: 1.6;
          font-size: 1.1em;
        }
        .note {
          display: block;
          margin: 2px 0;
        }
      }

      .loading * {
        transition: none !important;
        transform: none !important;
        animation: none !important;
      }
    </style>
  </head>
  <body>
    <div class="app">
      <div class="toggle-container">
        <select id="key-select" class="key-selector">
          <option value="C">C</option>
          <option value="C#">C# / Db</option>
          <option value="D">D</option>
          <option value="D#">D# / Eb</option>
          <option value="E">E</option>
          <option value="F">F</option>
          <option value="F#">F# / Gb</option>
          <option value="G">G</option>
          <option value="G#">G# / Ab</option>
          <option value="A">A</option>
          <option value="A#">A# / Bb</option>
          <option value="B">B</option>
        </select>
        <button id="secondary-toggle" class="toggle-button">V/vi</button>
        <button id="vii-toggle" class="toggle-button">viiÂ°</button>
        <button id="fullscreen-toggle" class="toggle-button">FS</button>
      </div>

      

      <div id="chords-display" class="chords-display">
        <div class="chord-card">
          <div class="roman-numeral">I</div>
          <div class="chord-name">C</div>
          <div class="chord-notes"></div>
        </div>
        <div class="chord-card">
          <div class="roman-numeral">ii</div>
          <div class="chord-name">Dm</div>
          <div class="chord-notes"></div>
        </div>
        <div class="chord-card" id="iii-card">
          <div class="roman-numeral">iii</div>
          <div class="chord-name">Em</div>
          <div class="chord-notes"></div>
        </div>
        <div class="chord-card">
          <div class="roman-numeral">IV</div>
          <div class="chord-name">F</div>
          <div class="chord-notes"></div>
        </div>
        <div class="chord-card">
          <div class="roman-numeral">V</div>
          <div class="chord-name">G</div>
          <div class="chord-notes"></div>
        </div>
        <div class="chord-card">
          <div class="roman-numeral">vi</div>
          <div class="chord-name">Am</div>
          <div class="chord-notes"></div>
        </div>
      </div>
    </div>

    <script>
      // --- DATA ---
      const notes = [
        "C",
        "C#",
        "D",
        "D#",
        "E",
        "F",
        "F#",
        "G",
        "G#",
        "A",
        "A#",
        "B",
      ];
      const majorScalePattern = [2, 2, 1, 2, 2, 2, 1];
      const romanNumerals = ["I", "ii", "iii", "IV", "V", "vi"];
      const chordQualities = [
        "major",
        "minor",
        "minor",
        "major",
        "major",
        "minor",
      ];
      const chordSuffixes = ["", "m", "m", "", "", "m"];

      // --- DOM ELEMENTS ---
      const keySelect = document.getElementById("key-select");
      const chordCards = document.querySelectorAll(".chord-card");
      const iiiCard = document.getElementById("iii-card");
      const secondaryToggle = document.getElementById("secondary-toggle");
      const viiToggle = document.getElementById("vii-toggle");
      const fullscreenToggle = document.getElementById("fullscreen-toggle");
      let selectedNote = null;

      // --- HELPER FUNCTIONS ---
      function getChordNotes(rootNote, quality) {
        const rootIndex = notes.indexOf(rootNote);
        const thirdInterval = quality === "major" ? 4 : 3;
        const thirdIndex = (rootIndex + thirdInterval) % 12;
        const fifthIndex = (rootIndex + 7) % 12;

        return [notes[rootIndex], notes[thirdIndex], notes[fifthIndex]];
      }

      function createNoteSpans(notesArray) {
        return notesArray
          .map((note) => `<span class="note" data-note="${note}">${note}</span>`)
          .join(" ");
      }

  

      function highlightChordsContainingNote(note) {
        if (!note) return;

        chordCards.forEach((card) => {
          const chordNameEl = card.querySelector(".chord-name");
          const chordName = chordNameEl.textContent;
          const rootNote = chordName.replace("m", "");
          
          // Get the note spans in this chord
          const chordNotesEl = card.querySelector(".chord-notes");
          const noteSpans = chordNotesEl.querySelectorAll(".note");
          const chordNotes = Array.from(noteSpans).map(
            (span) => span.dataset.note
          );
          
          // Remove previous highlighting
          card.classList.remove("matching", "non-matching");
          noteSpans.forEach((span) => span.classList.remove("highlighted"));

          // Check if the selected note is the root of this chord 
          // or if the selected note is contained in this chord's notes
          const isRootNote = notesAreEquivalent(rootNote, note);
          const containsNote = chordNotes.some(chordNote => notesAreEquivalent(chordNote, note));
          
          if (isRootNote || containsNote) {
            card.classList.add("matching");
            // Highlight the specific notes that match
            noteSpans.forEach((span) => {
              if (notesAreEquivalent(span.dataset.note, note)) {
                span.classList.add("highlighted");
              }
            });
          } else {
            card.classList.add("non-matching");
          }
        });
      }

      function clearNoteSelection() {
        selectedNote = null;

        // Remove highlighting from all cards and notes
        chordCards.forEach((card) => {
          card.classList.remove("matching", "non-matching");
          const noteSpans = card.querySelectorAll(".note");
          noteSpans.forEach((span) => span.classList.remove("highlighted"));
        });
      }

      function handleChordClick(event) {
        const card = event.currentTarget;
        const chordNameEl = card.querySelector(".chord-name");
        const chordName = chordNameEl.textContent;
        
        // Extract root note (remove 'm' for minor chords)
        const rootNote = chordName.replace("m", "");
        
        // If clicking the same chord, deselect it
        if (selectedNote === rootNote) {
          clearNoteSelection();
          return;
        }

        // Update state and highlight
        selectedNote = rootNote;
        highlightChordsContainingNote(rootNote);
      }

      function getViiNote() {
        const selectedKey = keySelect.value;
        const rootIndex = notes.indexOf(selectedKey);
        
        // Calculate vii note (leading tone, one semitone below tonic)
        const viiIndex = (rootIndex - 1 + 12) % 12;
        return notes[viiIndex];
      }
      
      // Helper function to check if two notes are enharmonically equivalent
      function notesAreEquivalent(note1, note2) {
        // For simplicity, just check exact match for now
        // Could be expanded to handle enharmonics like C#/Db
        return note1 === note2;
      }

      // --- CORE LOGIC ---
      function updateChords() {
        const selectedKey = keySelect.value;
        const rootIndex = notes.indexOf(selectedKey);

        // Calculate scale notes
        const scaleNotes = [];
        let currentIndex = rootIndex;
        scaleNotes.push(notes[currentIndex]);
        for (const step of majorScalePattern.slice(0, 5)) {
          currentIndex = (currentIndex + step) % 12;
          scaleNotes.push(notes[currentIndex]);
        }

        // Update each chord card
        chordCards.forEach((card, i) => {
          const rootNote = scaleNotes[i];
          const quality = chordQualities[i];
          const chordNotesArray = getChordNotes(rootNote, quality);

          // Update roman numeral and chord name
          card.querySelector(".roman-numeral").textContent = romanNumerals[i];
          card.querySelector(".chord-name").textContent =
            rootNote + chordSuffixes[i];

          // Update chord notes with note spans
          card.querySelector(".chord-notes").innerHTML =
            createNoteSpans(chordNotesArray);

          // Reset card class
          card.className = `chord-card chord-${quality}`;
        });

        // Ensure iii card keeps its ID
        iiiCard.id = "iii-card";

        // Re-apply highlighting if a note was selected
        if (selectedNote) {
          highlightChordsContainingNote(selectedNote);
        }
      }

      function toggleSecondaryDominant() {
        const romanEl = iiiCard.querySelector(".roman-numeral");
        const nameEl = iiiCard.querySelector(".chord-name");
        const notesEl = iiiCard.querySelector(".chord-notes");
        const rootNote = nameEl.textContent.replace("m", "");

        if (secondaryToggle.classList.contains("active")) {
          // Show Secondary Dominant (V/vi)
          romanEl.textContent = "V/vi";
          nameEl.textContent = rootNote;
          const chordNotesArray = getChordNotes(rootNote, "major");
          notesEl.innerHTML = createNoteSpans(chordNotesArray);
          iiiCard.className = "chord-card chord-secondary";
        } else {
          // Show diatonic iii
          romanEl.textContent = "iii";
          nameEl.textContent = rootNote + "m";
          const chordNotesArray = getChordNotes(rootNote, "minor");
          notesEl.innerHTML = createNoteSpans(chordNotesArray);
          iiiCard.className = "chord-card chord-minor";
        }

        iiiCard.id = "iii-card";

        // Re-apply highlighting if a note was selected
        if (selectedNote) {
          highlightChordsContainingNote(selectedNote);
        }
      }

      // --- EVENT LISTENERS ---
      keySelect.addEventListener("change", updateChords);

      secondaryToggle.addEventListener("click", function () {
        secondaryToggle.classList.toggle("active");
        toggleSecondaryDominant();
      });

      viiToggle.addEventListener("click", function () {
        const viiNote = getViiNote();
        
        // If clicking the same note, deselect it
        if (selectedNote === viiNote) {
          clearNoteSelection();
          return;
        }
        
        // Update state and highlight
        selectedNote = viiNote;
        highlightChordsContainingNote(viiNote);
      });

      fullscreenToggle.addEventListener("click", function () {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen().catch(err => {
            console.log(`Error attempting to enable fullscreen: ${err.message}`);
          });
        } else {
          document.exitFullscreen();
        }
      });

      // Add click listeners to each chord card
      chordCards.forEach(card => {
        card.addEventListener("click", handleChordClick);
      });

      

      // Add click-outside listener to clear selection
      document.addEventListener("click", function(event) {
        // Check if click is outside any chord card and not on the vii button
        const isChordCard = event.target.closest(".chord-card");
        const isViiButton = event.target === viiToggle || viiToggle.contains(event.target);
        
        if (!isChordCard && !isViiButton && selectedNote) {
          clearNoteSelection();
        }
      });

      // --- INITIALIZATION ---
      document.body.classList.add("loading");
      updateChords();
      setTimeout(() => {
        document.body.classList.remove("loading");
      }, 100);
    </script>
  </body>
</html>
